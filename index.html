<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.22.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.22.0/mapbox-gl.css' rel='stylesheet' />
    <link href='style/default.css' rel='stylesheet' />
    
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoid29ya3Nob3BzIiwiYSI6IjByNUpsazQifQ.126uDznXPUzRUim03Lh0FA';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/workshops/cirxfdt770031gunit6irxzv6', //stylesheet location
    center: [-2.12, 51.91], // starting position
    pitch: 60, // pitch in degrees
    bearing: 100.37, // bearing in degrees
    zoom: 15 // starting zoom
});
</script>

    
<div class="pin-top pin-left fade"></div>
    
<div class="player-container pin-bottom">
    <div class="player-shadow"></div>
    <div class="player-wrapper">
        <img src="img/player.gif" width="128" height="128" />
    </div>
    
</div>
    
    <!--
    <div class='buttons pin-bottomright space-right1 space-bottom1'>
    <button class='fl quiet round-left button icon caret-left js-left'></button>
    <button class='fl quiet round-top button icon caret-up pin-bottom button-up js-up'></button>
    <button class='fl quiet unround button icon caret-down js-down'></button>
    <button class='fl quiet round-right button icon caret-right js-right'></button>
  </div>-->
    <script>
    
   
var marker;
var delta = 100;

map.boxZoom.disable();
map.dragPan.disable();
map.doubleClickZoom.disable();
map.scrollZoom.disable();
map.keyboard.disable();
map.touchZoomRotate.disable();

var geolocate = new mapboxgl.Geolocate({position: 'top-right' });
map.addControl(geolocate);

geolocate.on('geolocate', function() {
  // Apparently this get's reset on result :/
  map.setBearing(-9.47);
  map.setPitch(45.00);
});

function easeTo(t) {
  if (marker && t === 1) marker.remove();
  return t * (2 - t);
}

function move(pos, bearing) {
  if (bearing) {
    map.easeTo({
      bearing: pos,
      easing: easeTo
    });
  } else {
    map.panBy(pos, {
      easing: easeTo
    });
  }
}

function goDirection(dir) {
  switch (dir) {
    case 'left':
      move(map.getBearing() - 25, true);
      break;
    case 'right':
      move(map.getBearing() + 25, true);
      break;
    case 'up':
      move([0, -delta]);
      break;
    case 'down':
      move([0, delta]);
      break;
  }
}

document.body.addEventListener('keydown', function(e) {
  switch (e.which) {
    case 38: // up
      goDirection('up');
    break;
    case 40: // down
      goDirection('down');
    break;
    case 37: // left
      goDirection('left');
    break;
    case 39: // right
      goDirection('right');
    break;
  }

}, true);


map.on('rotate', function() {
  var rotate = 'rotate(' + (map.transform.angle * (180 / Math.PI)) + 'deg)';

});

var buttonLeft = ['left', document.querySelector('.js-left')];
var buttonRight = ['right', document.querySelector('.js-right')];
var buttonTop = ['up', document.querySelector('.js-up')];
var buttonBottom = ['down', document.querySelector('.js-down')];

var buttons = [buttonLeft, buttonRight, buttonTop, buttonBottom];
var persist;

function buttonStart(b) {
  persist = setInterval(function() {
    goDirection(b[0]);
  }, 20);
}

function buttonEnd() {
  clearInterval(persist);
}

buttons.forEach(function(b) {
  b[1].addEventListener('mousedown', buttonStart.bind(this, b));
  b[1].addEventListener('touchstart', buttonStart.bind(this, b));
  b[1].addEventListener('mouseup', buttonEnd.bind(this, b));
  b[1].addEventListener('touchend', buttonEnd.bind(this, b));
});

function createMarker(e) {
  var markerEl = document.createElement('div');
  var dot = document.createElement('div');
  dot.className = 'waypoint-dot';
  var shadow = document.createElement('div');
  shadow.className = 'waypoint-shadow';
  markerEl.appendChild(dot);
  markerEl.appendChild(shadow);
  marker = new mapboxgl.Marker(markerEl).setLngLat(e.lngLat).addTo(map);

  window.setTimeout(function() {
    map.flyTo({
      center: e.lngLat,
      easing: easeTo
    });
  }, 500);
}

map.on('click', createMarker);
map.on('touchstart', createMarker);

    </script>
    
</body>
</html>
